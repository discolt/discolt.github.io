(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1436:function(n,s){n.exports={content:["article",{},["h2","建表"],["pre",{lang:"json",highlighted:'PUT score\n<span class="token punctuation">{</span>\n  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"_doc"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"score"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"integer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"integer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"integer"</span><span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nPUT user\n<span class="token punctuation">{</span>\n  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"_doc"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"integer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token property">"name"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"keyword"</span><span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nPUT subject\n<span class="token punctuation">{</span>\n  <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"_doc"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n        <span class="token property">"id"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"integer"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t<span class="token property">"name"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"keyword"</span><span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>'},["code",'PUT score\n{\n  "mappings": {\n    "_doc": {\n      "properties": {\n        "score": {"type":"integer"},\n\t\t"user_id": {"type":"integer"},\n\t\t"subject_id": {"type":"integer"}\n      }\n    }\n  }\n}\n\nPUT user\n{\n  "mappings": {\n    "_doc": {\n      "properties": {\n        "id": {"type":"integer"},\n\t\t"name": {"type":"keyword"}\n      }\n    }\n  }\n}\n\nPUT subject\n{\n  "mappings": {\n    "_doc": {\n      "properties": {\n        "id": {"type":"integer"},\n\t\t"name": {"type":"keyword"}\n      }\n    }\n  }\n}']],["h2","插入数据"],["pre",{lang:"json",highlighted:'POST user/_doc\n<span class="token punctuation">{</span>\n  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"jack"</span>\n<span class="token punctuation">}</span>\n\nPOST user/_doc\n<span class="token punctuation">{</span>\n  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"rose"</span>\n<span class="token punctuation">}</span>\n\nPOST subject/_doc\n<span class="token punctuation">{</span>\n  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"物理"</span>\n<span class="token punctuation">}</span>\n\nPOST subject/_doc\n<span class="token punctuation">{</span>\n  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"化学"</span>\n<span class="token punctuation">}</span>\n\nPOST score/_bulk\n<span class="token punctuation">{</span> <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"score"</span> <span class="token operator">:</span> <span class="token number">95</span><span class="token punctuation">,</span> <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token number">1</span>  <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"score"</span> <span class="token operator">:</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token number">2</span>  <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"score"</span> <span class="token operator">:</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token number">1</span>  <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"index"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"_type"</span> <span class="token operator">:</span> <span class="token string">"_doc"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>\n<span class="token punctuation">{</span> <span class="token property">"score"</span> <span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token number">2</span>  <span class="token punctuation">}</span>'},["code",'POST user/_doc\n{\n  "id": 1,\n  "name": "jack"\n}\n\nPOST user/_doc\n{\n  "id": 2,\n  "name": "rose"\n}\n\nPOST subject/_doc\n{\n  "id": 1,\n  "name": "物理"\n}\n\nPOST subject/_doc\n{\n  "id": 2,\n  "name": "化学"\n}\n\nPOST score/_bulk\n{ "index" : { "_type" : "_doc" } }\n{ "score" : 95, "user_id": 1, "subject_id": 1  }\n{ "index" : { "_type" : "_doc" } }\n{ "score" : 66, "user_id": 1, "subject_id": 2  }\n{ "index" : { "_type" : "_doc" } }\n{ "score" : 88, "user_id": 2, "subject_id": 1  }\n{ "index" : { "_type" : "_doc" } }\n{ "score" : 100, "user_id": 2, "subject_id": 2  }']],["h2","join检索"],["h3","案例1 - 查看 jack 的成绩表 (单表连接)"],["pre",{lang:"sql",highlighted:'<span class="token keyword">SELECT</span> score<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> score\n<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token keyword">user</span>\n<span class="token keyword">ON</span> <span class="token keyword">user</span><span class="token punctuation">.</span>id<span class="token operator">=</span>score<span class="token punctuation">.</span>user_id\n<span class="token keyword">WHERE</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">\'jack\'</span>'},["code","SELECT score.* FROM score\nLEFT JOIN user\nON user.id=score.user_id\nWHERE user.name='jack'"]],["h4","By JoinedQuery"],["pre",{lang:"json",highlighted:'GET score/_search\n<span class="token punctuation">{</span>\n\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t<span class="token property">"joined"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t\t\t<span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t<span class="token property">"join"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n\t\t\t\t<span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t\t\t\t<span class="token property">"indices"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>\n\t\t\t\t\t<span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span>\n\t\t\t\t\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t\t\t\t\t<span class="token property">"term"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"jack"</span> <span class="token punctuation">}</span>\n\t\t\t\t\t<span class="token punctuation">}</span>\n\t\t\t\t<span class="token punctuation">}</span>\n\t\t\t<span class="token punctuation">}</span><span class="token punctuation">]</span>\n\t\t<span class="token punctuation">}</span>\n\t<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>'},["code",'GET score/_search\n{\n\t"query": {\n\t\t"joined": {\n\t\t\t"query": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"join": [{\n\t\t\t\t"user_id": {\n\t\t\t\t\t"indices": "user",\n\t\t\t\t\t"field": "id",\n\t\t\t\t\t"query": {\n\t\t\t\t\t\t"term" : { "name" : "jack" }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}]\n\t\t}\n\t}\n}']],["h3","案例2- 查看 jack 同学的物理成绩表 (多子表连接)"],["pre",{lang:"sql",highlighted:'<span class="token keyword">SELECT</span> score<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> score\n<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token keyword">user</span>\n<span class="token keyword">ON</span> <span class="token keyword">user</span><span class="token punctuation">.</span>id<span class="token operator">=</span>score<span class="token punctuation">.</span>user_id\n<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> subject\n<span class="token keyword">ON</span> subject<span class="token punctuation">.</span>id<span class="token operator">=</span>score<span class="token punctuation">.</span>subject_id\n<span class="token keyword">WHERE</span> <span class="token keyword">user</span><span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">\'?\'</span> <span class="token operator">AND</span> subject<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">\'?\'</span>'},["code","SELECT score.* FROM score\nLEFT JOIN user\nON user.id=score.user_id\nLEFT JOIN subject\nON subject.id=score.subject_id\nWHERE user.name='?' AND subject.name='?'"]],["h4","By JoinedQuery"],["pre",{lang:"json",highlighted:'GET score/_search\n<span class="token punctuation">{</span>\n\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t<span class="token property">"joined"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n\t\t\t\t<span class="token property">"match_all"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\t\t\t<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t<span class="token property">"join"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n\t\t\t  <span class="token punctuation">{</span>\n  \t\t\t\t<span class="token property">"user_id"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  \t\t\t\t\t<span class="token property">"indices"</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>\n  \t\t\t\t\t<span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span>\n  \t\t\t\t\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  \t\t\t\t\t\t<span class="token property">"term"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"jack"</span> <span class="token punctuation">}</span>\n  \t\t\t\t\t<span class="token punctuation">}</span>\n  \t\t\t\t<span class="token punctuation">}</span>\n\t\t\t  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t\t\t  <span class="token punctuation">{</span>\n  \t\t\t\t<span class="token property">"subject_id"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  \t\t\t\t\t<span class="token property">"indices"</span><span class="token operator">:</span> <span class="token string">"subject"</span><span class="token punctuation">,</span>\n  \t\t\t\t\t<span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span>\n  \t\t\t\t\t<span class="token property">"query"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n  \t\t\t\t\t\t<span class="token property">"term"</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"name"</span> <span class="token operator">:</span> <span class="token string">"物理"</span> <span class="token punctuation">}</span>\n  \t\t\t\t\t<span class="token punctuation">}</span>\n  \t\t\t\t<span class="token punctuation">}</span>\n\t\t\t  <span class="token punctuation">}</span>\n\t\t\t<span class="token punctuation">]</span>\n\t\t<span class="token punctuation">}</span>\n\t<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>'},["code",'GET score/_search\n{\n\t"query": {\n\t\t"joined": {\n\t\t\t"query": {\n\t\t\t\t"match_all": {}\n\t\t\t},\n\t\t\t"join": [\n\t\t\t  {\n  \t\t\t\t"user_id": {\n  \t\t\t\t\t"indices": "user",\n  \t\t\t\t\t"field": "id",\n  \t\t\t\t\t"query": {\n  \t\t\t\t\t\t"term" : { "name" : "jack" }\n  \t\t\t\t\t}\n  \t\t\t\t}\n\t\t\t  },\n\t\t\t  {\n  \t\t\t\t"subject_id": {\n  \t\t\t\t\t"indices": "subject",\n  \t\t\t\t\t"field": "id",\n  \t\t\t\t\t"query": {\n  \t\t\t\t\t\t"term" : { "name" : "物理" }\n  \t\t\t\t\t}\n  \t\t\t\t}\n\t\t\t  }\n\t\t\t]\n\t\t}\n\t}\n}']],["h2","重要说明"],["ol",["li",["p",["strong","关联字段类型"]," 关联外键请使用数值类型（integer或long)。"]],["li",["p",["strong","数据裁剪"]," 出于对服务端的保护，join操作在取中间结果集时有个阈值保护，默认阈值为100万，超出阈值则中断查询，若发生截断SearchResponse会增加 ealy_terminated:true 提示检索数据被裁剪。"]]]],meta:{category:"API扩展",order:8,title:{"zh-CN":"JoinedQuery (Beta)","en-US":"JoinedQuery (Beta)"},filename:"docs/usage/es-join.md"},description:["section",["p","JoinedQuery 从引擎层面实现了跨索引过滤功能，用以简化 ES 在多个索引间的关系处理。 Join基本上是基于共同属性的两组文档之间的semi-join，其中结果仅包含文档集合的一个属性。该连接用于过滤基于第二文档集的一个文档集，相当于SQL中的EXISTS算子。"],["h2","示例"],["ul",["li",["p","主表"],["ul",["li",["p","score : 成绩表"]]]],["li",["p","子表"],["ul",["li",["p","user : 学生表"]],["li",["p","subject : 科目表"]]]]],["p","关联关系"],["pre",{lang:null,highlighted:'score<span class="token punctuation">.</span>user_id <span class="token operator">=</span> user<span class="token punctuation">.</span>id\nscore<span class="token punctuation">.</span>subject_id <span class="token operator">=</span> subject<span class="token punctuation">.</span>id'},["code","score.user_id = user.id\nscore.subject_id = subject.id"]],["p",["strong","注意："]," 关联外键类型需使用数值类型（integer或long)"]],toc:["ul",["li",["a",{className:"bisheng-toc-h2",href:"#建表",title:"建表"},"建表"]],["li",["a",{className:"bisheng-toc-h2",href:"#插入数据",title:"插入数据"},"插入数据"]],["li",["a",{className:"bisheng-toc-h2",href:"#join检索",title:"join检索"},"join检索"]],["li",["a",{className:"bisheng-toc-h2",href:"#重要说明",title:"重要说明"},"重要说明"]]]}}}]);