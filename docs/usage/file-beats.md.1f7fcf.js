(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{1440:function(a,e){a.exports={content:["article",["p","Filebeat 是 Elastic 公司推出的一款轻量数据采集工具。与 logstash 不同的是，Filebeat 的日志结构化是放在Elasticsearch 的 ingest 节点进行的。因此 Filebeat agent 的负载更低，压力更小。使用 FileBeat 接入蚂蚁 ZSearch 和普通 Elaticsearch 的主要差异在于 ZSearch 目前不支持自动建表，所以需要关闭模板，采用手动建表方式创建索引，然后再写入。"],["h2","接入方法"],["p","FileBeat 接入 ZSearch 主要包括以下步骤："],["ol",["li",["p","创建日志型表"]],["li",["p","编辑 Filebeat 配置"]],["li",["p","启动 Filebeat"]]],["h3","创建日志型表"],["p",["strong","说明"],"：表名支持自定义，本文以 ",["code","filebeat_log"]," 为例。"],["ol",["li",["p","导出 Filebeat 模板 (如果自行修改了 fields 文件，则需在配置中指定 ",["strong","setup.template.fields"],': "fields.yml" 方可生效)']],["li",["p","MacOS 系统，运行以下命令："]]],["pre",{lang:null,highlighted:'<span class="token punctuation">.</span><span class="token operator">/</span>filebeat export template <span class="token operator">></span> filebeat<span class="token punctuation">.</span>template<span class="token punctuation">.</span>json'},["code","./filebeat export template > filebeat.template.json"]],["ul",["li",["p","如用 Docker，可以运行以下命令："]]],["pre",{lang:null,highlighted:'docker run docker<span class="token punctuation">.</span>elastic<span class="token punctuation">.</span>co<span class="token operator">/</span>beats<span class="token operator">/</span>filebeat<span class="token punctuation">:</span><span class="token number">6.6</span><span class="token punctuation">.</span><span class="token number">0</span> export template <span class="token operator">></span> filebeat<span class="token punctuation">.</span>template<span class="token punctuation">.</span>json'},["code","docker run docker.elastic.co/beats/filebeat:6.6.0 export template > filebeat.template.json"]],["ul",["li",["p","其他环境下的导出方式，参见 ",["a",{title:null,href:"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html#load-template-manually-alternate"},"导出 Filebeat 模板"],"。"]],["li",["p","编辑导出的 ",["code","filebeat.template.json"]," 文件。"]],["li",["p","增加 ",["code",'"settings.keep_days":7']," ，7 为保留天数，可自行设置。"]],["li",["p","（可选）删去 ",["code","index_patterns"]," 和 ",["code","order"],"。"]],["li",["p","创建表，以 Shell 为例，运行以下命令："]]],["pre",{lang:"shell",highlighted:'curl <span class="token operator">-</span>XPUT <span class="token operator">-</span>u <span class="token variable">$username</span><span class="token punctuation">:</span><span class="token variable">$password</span> <span class="token operator">-</span>H <span class="token string">"Content-Type: application/json"</span> <span class="token variable">$api</span><span class="token operator">/</span>filebeat_log <span class="token operator">-</span>d <span class="token variable">@filebeat</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span>json'},["code",'curl -XPUT -u $username:$password -H "Content-Type: application/json" $api/filebeat_log -d @filebeat.template.json']],["ol",["li",["p",["strong","说明"],"："]],["li",["p","其中 username、password 与 api，可以在 ZSearch 控制台应用详情页获得。"]],["li",["p","返回  ",["code",'"acknowledged":true']," 即为成功。"]],["li",["p","运行成功后，即可在 应用详情页 > 索引列表 中看到 ",["code","filebeat_log"]," 表。",["br"],"\n",["img",{title:null,src:"https://cdn.nlark.com/yuque/0/2019/png/163907/1557110328780-1782b265-38d1-48a1-ba75-bef27afb565a.png#align=left&display=inline&height=1352&originHeight=1352&originWidth=2508&size=0&status=done&width=2508",alt:null}]]]],["h3","编辑 Filebeat 配置"],["ol",["li",["p","执行 ",["code","setup.template.enabled: false"],"，关闭模板。"]],["li",["p","配置相关参数："]],["li",["p",'hosts：即 ZSearch 控制台上的 API 地址去掉 "http(https)" 前缀']],["li",["p","protocol：即 API 的前缀 （http 或 https）"]],["li",["p","username：等同于控制台上的用户名"]],["li",["p","password：等同于控制台上的密码"]],["li",["p","index：即刚刚创建的表名，本文示例为 ",["code","filebeat_log"],"。"]]],["pre",{lang:"yaml",highlighted:'<span class="token key atrule">output.elasticsearch</span><span class="token punctuation">:</span>\n  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"zsearch.cloud.alipay.com:9999"</span><span class="token punctuation">]</span>\n  <span class="token key atrule">protocol</span><span class="token punctuation">:</span> <span class="token string">"http"</span>\n  <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"example"</span>\n  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"example_password"</span>\n  <span class="token key atrule">index</span><span class="token punctuation">:</span> <span class="token string">"filebeat_log"</span>'},["code",'output.elasticsearch:\n  hosts: ["zsearch.cloud.alipay.com:9999"]\n  protocol: "http"\n  username: "example"\n  password: "example_password"\n  index: "filebeat_log"']],["p","3.（可选）如要配置 Kibana 图表，具体参数如下："],["ul",["li",["p","host：即控制台域名地址"]],["li",["p","protocol：即控制台的 scheme"]],["li",["p","path：即 ",["code","/kibana"]]],["li",["p","username：等同于控制台上的用户名"]],["li",["p","password：等同于控制台上的密码"]]],["pre",{lang:"yaml",highlighted:'<span class="token key atrule">setup.kibana</span><span class="token punctuation">:</span>\n  <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"zsearch.cloud.alipay.com"</span>\n  <span class="token key atrule">protocol</span><span class="token punctuation">:</span> <span class="token string">"http"</span>\n  <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"/kibana"</span>\n  <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"example"</span>\n  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"example_password"</span>\n<span class="token key atrule">setup.dashboards.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true </span><span class="token comment" spellcheck="true">#每次启动都加载一次 dashboard，也可以关闭，手动`setup --dashboards`加载</span>\n<span class="token key atrule">setup.dashboards.index</span><span class="token punctuation">:</span> <span class="token string">"filebeat_log"</span> <span class="token comment" spellcheck="true">#和上面 output.elasticsearch.index 的表名一样</span>'},["code",'setup.kibana:\n  host: "zsearch.cloud.alipay.com"\n  protocol: "http"\n  path: "/kibana"\n  username: "example"\n  password: "example_password"\nsetup.dashboards.enabled: true #每次启动都加载一次 dashboard，也可以关闭，手动`setup --dashboards`加载\nsetup.dashboards.index: "filebeat_log" #和上面 output.elasticsearch.index 的表名一样']],["h3","启动 Filebeat"],["ul",["li",["p","MacOS 系统，运行以下命令："]]],["pre",{lang:null,highlighted:'sudo <span class="token punctuation">.</span><span class="token operator">/</span>filebeat <span class="token operator">-</span>e'},["code","sudo ./filebeat -e"]],["ul",["li",["p","其他环境的启动方式，参见 ",["a",{title:null,href:"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-starting.html#filebeat-starting"},"启动 Filebeat"],"。"]]],["h2","注意事项"],["ul",["li",["p","Filebeat 通过不同的 module 采集不同的日志，官方提供了多种 module。详见 ",["a",{title:null,href:"https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html"},"Filebeat  module"],"。"]],["li",["p","每个 module 均有自己的配置，存放在 ",["code","modules.d"]," 文件夹下。配置中表明了日志位置。如果文件名结尾为 ",["code",".disabled"]," 则表示该 module 未启用。Filebeat 每次启动时，会自动检测 ",["code","moudles.d"]," 文件夹以获取启用的 module 配置。"]],["li",["p","如需自己添加 module，则只需模仿现有 module 在 ",["code","modules"]," 和 ",["code","models.d"]," 下添加相应文件即可。"]]]],meta:{category:"生态",order:4,title:{"zh-CN":"File Beat","en-US":"File Beat"},subtitle:"文件数据采集",filename:"docs/usage/file-beats.md"},toc:["ul",["li",["a",{className:"bisheng-toc-h2",href:"#接入方法",title:"接入方法"},"接入方法"]],["li",["a",{className:"bisheng-toc-h2",href:"#注意事项",title:"注意事项"},"注意事项"]]]}}}]);