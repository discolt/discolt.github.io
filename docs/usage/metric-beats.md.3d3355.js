(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1444:function(a,s){a.exports={content:["article",["p","MetricBeat 为 Elastic 公司提供的一个用于 Metric 数据采集的工具。其预设了许多 metric 数据源，可以导入 Elasticsearch 进行展示分析。ZSearch 也提供了对 MetricBeat 的支持。"],["p","接入方法与 Filebeat 类似，主要步骤如下："],["ol",["li",["p","创建表"]],["li",["p","修改配置"]]],["h2","创建表"],["blockquote",["p",["strong","说明"],"：表名支持自定义，本文以 ",["code","metricbeat_log"]," 为例。"]],["ol",["li",["p","导出 Metricbeat 模板。"]],["li",["p","MacOS 系统，运行以下命令："]]],["pre",{lang:null,highlighted:'<span class="token punctuation">.</span><span class="token operator">/</span>metricbeat export template <span class="token operator">></span> metricbeat<span class="token punctuation">.</span>template<span class="token punctuation">.</span>json'},["code","./metricbeat export template > metricbeat.template.json"]],["ul",["li",["p","其他环境，参见 导出 Metricbeat 模板。"]],["li",["p","打开导出的 ",["code","metricbeat.template.json"]," 文件，增加 ",["code",'"settings.keep_days":7']," 配置。"]]],["div",{style:"text-align: left; margin: 40px 0px;"},["img",{width:"50%",src:"https://gw.alipayobjects.com/zos/antfincdn/I0JkUdN4ZG/afbb9c1e-cc69-48ee-ba00-41e7cc84830c.png"}]],["ol",["li",["p","通过 API 创建表，以 Shell 脚本为例，运行以下命令："]]],["pre",{lang:"shell",highlighted:'curl <span class="token operator">-</span>XPUT <span class="token operator">-</span>u <span class="token variable">$username</span><span class="token punctuation">:</span><span class="token variable">$password</span> <span class="token operator">-</span>H <span class="token string">"Content-Type: application/json"</span> <span class="token string">"$api/metricbeat_log"</span> <span class="token operator">-</span>d <span class="token variable">@metricbeat</span><span class="token punctuation">.</span>template<span class="token punctuation">.</span>json'},["code",'curl -XPUT -u $username:$password -H "Content-Type: application/json" "$api/metricbeat_log" -d @metricbeat.template.json']],["p",["strong","说明"],"："],["ul",["li",["p","其中 username、password 与 api，可以在 ZSearch 控制台应用详情页获得。"]],["li",["p","返回  ",["code",'"acknowledged":true']," 即为成功。"]],["li",["p","运行成功后，即可在 应用详情页 > 索引列表 中看到 ",["code","metricbeat_log"]," 表。\n",["img",{title:null,src:"https://cdn.nlark.com/yuque/0/2019/png/163907/1557111306186-109f78bf-1edf-448a-a961-782a8d83bb8c.png#align=left&display=inline&height=1352&originHeight=1352&originWidth=2506&size=0&status=done&width=2506",alt:null}]]]],["h3","修改配置文件"],["ol",["li",["p","关闭模板 ",["code","setup.template.enabled: false"],"。"]],["li",["p","填写 Elasticsearch 配置："],["ul",["li",["p","hosts：即控制台上的 API 去掉 http(https) 前缀"]],["li",["p","protocol：即控制台中 API 的前缀（http 或 https）"]],["li",["p","username：等同于控制台上的用户名"]],["li",["p","password：等同于控制台上的密码"]],["li",["p","index：即刚刚创建的表名，本文为 ",["code","metricbeat_log"],"。"]]]],["li",["p","（可选）配置 Kibana 图表："],["ul",["li",["p","host：即控制台域名地址，必须加上 80 端口号，不然默认会添加 5601 端口，造成错误。"]],["li",["p","protocol：即控制台的 scheme（http 或 https）"]],["li",["p","path：即 ",["code","/kibana"]]],["li",["p","username：等同于控制台上的用户名"]],["li",["p","password：等同于控制台上的密码"]],["li",["p","setup.dashboards.index：即刚刚创建的表名，本文为 ",["code","metricbeat_log"],"。"]]]]],["p",["strong","完整示例如下："]],["pre",{lang:"yaml",highlighted:'<span class="token comment" spellcheck="true"># 关闭模板</span>\n<span class="token key atrule">setup.template.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>\n<span class="token comment" spellcheck="true"># 设置 elasticsearch 输出地址</span>\n<span class="token key atrule">output.elasticsearch</span><span class="token punctuation">:</span>\n  <span class="token comment" spellcheck="true"># 控制台上的 api 地址去掉 http(https) 前缀</span>\n  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"zsearch.cloud.alipay.com:9999"</span><span class="token punctuation">]</span>\n  <span class="token comment" spellcheck="true"># 控制台上的 api 的 http(https) 前缀</span>\n  <span class="token key atrule">protocol</span><span class="token punctuation">:</span> <span class="token string">"http"</span>\n  <span class="token comment" spellcheck="true"># 控制台上的 用户名</span>\n  <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"example"</span>\n  <span class="token comment" spellcheck="true"># 控制台上的 密码</span>\n  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"example_password"</span>\n  <span class="token comment" spellcheck="true"># 上文创建的 index</span>\n  <span class="token key atrule">index</span><span class="token punctuation">:</span> <span class="token string">"metricbeat_log"</span>\n<span class="token comment" spellcheck="true"># 可选，配置 kibana 地址</span>\n<span class="token key atrule">setup.kibana</span><span class="token punctuation">:</span>\n  <span class="token comment" spellcheck="true"># 控制台域名地址，一定要加上80端口号，不然默认会添加5601端口，造成错误</span>\n  <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">"zsearch.cloud.alipay.com"</span>\n  <span class="token comment" spellcheck="true"># 控制台的scheme (http或https)</span>\n  <span class="token key atrule">protocol</span><span class="token punctuation">:</span> <span class="token string">"http"</span>\n  <span class="token comment" spellcheck="true"># 固定参数</span>\n  <span class="token key atrule">path</span><span class="token punctuation">:</span> /kibana\n  <span class="token comment" spellcheck="true"># 控制台上的 用户名</span>\n  <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">"example"</span>\n  <span class="token comment" spellcheck="true"># 控制台上的 密码</span>\n  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">"example_password"</span>\n<span class="token comment" spellcheck="true"># 可选，配置图表</span>\n<span class="token comment" spellcheck="true"># 如果为 true，则每次启动均会重新写入 dashboard（会造成自行修改部分被覆盖），如果为 false ,则需 `./metricbeat setup --dashboards` 手动导入</span>\n<span class="token key atrule">setup.dashboards.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>\n<span class="token comment" spellcheck="true"># 如需要用 dashboard 图表一定要配置此选项，不然所有图表均找不到缩影，此处配置为上文创建的 index</span>\n<span class="token key atrule">setup.dashboards.index</span><span class="token punctuation">:</span> <span class="token string">"metricbeat_log"</span>'},["code",'# 关闭模板\nsetup.template.enabled: false\n# 设置 elasticsearch 输出地址\noutput.elasticsearch:\n  # 控制台上的 api 地址去掉 http(https) 前缀\n  hosts: ["zsearch.cloud.alipay.com:9999"]\n  # 控制台上的 api 的 http(https) 前缀\n  protocol: "http"\n  # 控制台上的 用户名\n  username: "example"\n  # 控制台上的 密码\n  password: "example_password"\n  # 上文创建的 index\n  index: "metricbeat_log"\n# 可选，配置 kibana 地址\nsetup.kibana:\n  # 控制台域名地址，一定要加上80端口号，不然默认会添加5601端口，造成错误\n  host: "zsearch.cloud.alipay.com"\n  # 控制台的scheme (http或https)\n  protocol: "http"\n  # 固定参数\n  path: /kibana\n  # 控制台上的 用户名\n  username: "example"\n  # 控制台上的 密码\n  password: "example_password"\n# 可选，配置图表\n# 如果为 true，则每次启动均会重新写入 dashboard（会造成自行修改部分被覆盖），如果为 false ,则需 `./metricbeat setup --dashboards` 手动导入\nsetup.dashboards.enabled: true\n# 如需要用 dashboard 图表一定要配置此选项，不然所有图表均找不到缩影，此处配置为上文创建的 index\nsetup.dashboards.index: "metricbeat_log"']],["h2","注意事项"],["ul",["li",["p","MetricBeat 提供了许多现成的 module，使用 ",["code","./metricbeat modules enable"]," 启动，然后修改 module 配置即可开始使用。"]],["li",["p","Module 列表，可参见 ",["a",{title:null,href:"https://www.elastic.co/guide/en/beats/metricbeat/current/metricbeat-modules.html"},"官方文档"],"。"]]],["h2","使用示例"],["p","下面以在 Mac 系统上收集 Docker 数据为例，简单介绍如何接入使用 MetricBeat。"],["p","操作步骤如下："],["ol",["li",["p","按照上文接入方法，创建修改 ",["code","metricbeat_log"]," 表，导入完成 dashboard。"]],["li",["p","运行以下命令，启动 docker 的 module"]]],["pre",{lang:null,highlighted:'<span class="token punctuation">.</span><span class="token operator">/</span>metricbeat modules enable docker'},["code","./metricbeat modules enable docker"]],["ol",["li",["p","编辑 ",["code","/modules.d/docker.yml"]," 配置文件。"]],["li",["p","展开监控指标 ",["code","metricsets"],"。"]],["li",["p","修改 hosts 为自己的 docker.sock。如果是标准 Docker for Mac 则无需修改，用默认地址即可。",["img",{title:null,src:"https://gw.alipayobjects.com/zos/antfincdn/tAHCQxNNfr/7bd57974-08f5-4bbf-b3e0-aa7c09a9da4b.png#align=left&display=inline&height=476&originHeight=540&originWidth=823&width=726#align=left&display=inline&height=540&originHeight=540&originWidth=823&status=done&width=823",alt:null}]]],["li",["p","运行以下命令启动 MetricBeat 服务："]]],["pre",{lang:null,highlighted:'<span class="token punctuation">.</span><span class="token operator">/</span>metricbeat <span class="token operator">-</span>e'},["code","./metricbeat -e"]],["ol",["li",["p","稍等 15s 后，即可在 ",["strong","Kibana > Dashboard > ",["span","Metricbeat Docker"]," Overview"]," 中查看当前数据。",["img",{title:null,src:"https://gw.alipayobjects.com/zos/antfincdn/7JvQZSp8AD/d44bdc7f-4d36-48d1-8207-cb101d99493b.png#align=left&display=inline&height=380&originHeight=1003&originWidth=1917&width=726#align=left&display=inline&height=1003&originHeight=1003&originWidth=1917&status=done&width=1917",alt:null}]]]]],meta:{category:"生态",order:5,title:{"zh-CN":"Metric Beat","en-US":"Metric Beat"},subtitle:"度量数据采集",filename:"docs/usage/metric-beats.md"},toc:["ul",["li",["a",{className:"bisheng-toc-h2",href:"#创建表",title:"创建表"},"创建表"]],["li",["a",{className:"bisheng-toc-h2",href:"#注意事项",title:"注意事项"},"注意事项"]],["li",["a",{className:"bisheng-toc-h2",href:"#使用示例",title:"使用示例"},"使用示例"]]]}}}]);